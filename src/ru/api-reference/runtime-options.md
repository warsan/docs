# Варианты исполнения

::: v-pre

Функции `Handlebars.compile` и `Handlebars.precompile` создают функцию. Эта функция может быть вызвана как `template(context, options)`, где `context` - входной объект.

`options` - это объект, который может иметь любое из следующих свойств

- `data` Передайте объект для определения пользовательских частных переменных `@variable`.
- `helpers` Передайте, чтобы предоставить настраиваемые помощники в дополнение к глобально определённым помощникам.  
  Значения, определенные в этом объекте, заменят любые значения, определённые в глобальном объекте, на время выполнения шаблона.
- `partials` Передайте, чтобы предоставить настраиваемые партиалы в дополнение к глобально определённым частям.  
  Значения, определённые в этом объекте, заменят любые значения, определённые в глобальном объекте, на время выполнения шаблона.
- `allowCallsToHelperMissing` (начиная с 4.3.0, небезопасно): если установлено значение `true`, вызовы типа `{{helperMissing}}` и `{{blockHelperMissing}}` будут разрешены. Обратите внимание, что это позволяет авторам шаблонов создавать шаблоны для удалённого выполнения кода в среде, в которой запущены Handlebars (см. https://github.com/wycats/handlebars.js/issues/1558)

:::

## Варианты управления доступом к прототипу:

Начиная с версии 4.6.0, Handlebars по умолчанию запрещает доступ к свойствам и методам прототипа объекта контекста.
Причина в различных проблемах безопасности, которые возникают из-за такой возможности. Следующие параметры можно использовать для управления этим доступом.

::: опасно. Использование этих свойств может открыть дыры в безопасности.

Разрешение свойств прототипа может позволить авторам шаблонов выполнять произвольный код на компьютере, где работает Handlebars. Даже при наличии некоторых ограничений злоумышленник может сфабриковать шаблоны Handlebars, которые приведут к сбою вашего компьютера.

Подробности можно найти в рекомендациях npm-security [755](https://www.npmjs.com/advisories/755),
[1164](https://www.npmjs.com/advisories/1164), [1316](https://www.npmjs.com/advisories/1316),
[1324](https://www.npmjs.com/advisories/1324) and [1325](https://www.npmjs.com/advisories/1325) и в блоге-статье [Mahmoud Gamal](http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html).

:::

- `allowProtoMethodsByDefault` (начиная с 4.7.0): логическое значение (по умолчанию: false), - определяющее, разрешаются ли по умолчанию методы, определенные в прототипе объекта.

  Методы `constructor`, `__defineGetter__`, `__defineSetter__`, `__lookupGetter__` и `__lookupSetter__` запрещены, даже если для этой опции установлено значение `true`. Они могут быть доступны только в том случае, если соответствующий ключ в `allowedProtoMethods` установлен в `true`.

  Установка для этого параметра любого значения отключает предупреждение, которое Handlebars записывает в консоль, если попытка доступа к прото-методу запрещена.

- `allowedProtoMethods` (начиная с 4.6.0): преобразование строки в логическое отображение имен свойств, которые разрешены, если они являются методами родительского объекта. Неопределенные значения возвращают значение, определенное в `allowProtoMethodsByDefault`.
- `allowProtoPropertiesByDefault` (начиная с 4.7.0): логическое значение (по умолчанию: false), - определяет, должны ли свойства, не являющиеся методами, определенными в прототипе объекта, разрешаться по умолчанию.

  Свойство `__proto__` запрещено, даже если для этого параметра установлено значение `true`. Доступ к нему возможен только в том случае, если соответствующий ключ в `allowedProtoProperties` установлен в значение `true`.

  Установка для этого параметра любого значения отключает предупреждение, которое Handlebars записывает в консоль, если попытка доступа к прото-свойству запрещена.

- `allowedProtoProperties` (начиная с 4.6.0): преобразование строки в логическое отображение имён свойств, которые разрешены, если они являются свойствами, но не методами родительского объекта. Неопределённые значения возвращаются к значению, определённому в
  `allowProtoPropertiesByDefault`

  ```js
  const template = handlebars.compile("{{aString.trim}}");
  const result = template({ aString: "  abc  " });
  // результат пуст, потому что обрезка определена в прототипе String
  ```

  ```js
  const template = handlebars.compile("{{aString.trim}}");
  const result = template(
    { aString: "  abc  " },
    {
      allowedProtoMethods: {
        trim: true
      }
    }
  );
  // result = 'abc'
  ```

Вы также можете использовать пакет
[@handlebars/allow-prototype-access](https://www.npmjs.com/package/@handlebars/allow-prototype-access) возвращающий к поведению 4.5.3
в случаях, когда вы не можете передать параметры времени выполнения, например, в
[express-handlebars](https://www.npmjs.com/package/express-handlebars).
